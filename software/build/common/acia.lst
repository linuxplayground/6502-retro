ca65 V2.18 - Ubuntu 2.18-1
Main file   : common/src/acia.s
Current file: common/src/acia.s

000000r 1                       .import __ACIA_START__
000000r 1                       .export ACIA_DATA
000000r 1                       .export ACIA_STATUS
000000r 1                       .export ACIA_COMMAND
000000r 1                       .export ACIA_CONTROL
000000r 1                       .export _acia_init
000000r 1                       .export _acia_read_byte
000000r 1                       .export _acia_read_byte_nw
000000r 1                       .export _acia_write_byte
000000r 1               
000000r 1               ACIA_DATA    = __ACIA_START__ + $00
000000r 1               ACIA_STATUS  = __ACIA_START__ + $01
000000r 1               ACIA_COMMAND = __ACIA_START__ + $02
000000r 1               ACIA_CONTROL = __ACIA_START__ + $03
000000r 1               
000000r 1               ; ACIA command register bit values
000000r 1               
000000r 1               ACIA_PARITY_ODD              = %00000000
000000r 1               ACIA_PARITY_EVEN             = %01000000
000000r 1               ACIA_PARITY_MARK             = %10000000
000000r 1               ACIA_PARITY_SPACE            = %11000000
000000r 1               ACIA_PARITY_DISABLE          = %00000000
000000r 1               ACIA_PARITY_ENABLE           = %00100000
000000r 1               ACIA_ECHO_DISABLE            = %00000000
000000r 1               ACIA_ECHO_ENABLE             = %00010000
000000r 1               ACIA_TX_INT_DISABLE_RTS_HIGH = %00000000
000000r 1               ACIA_TX_INT_ENABLE_RTS_LOW   = %00000100
000000r 1               ACIA_TX_INT_DISABLE_RTS_LOW  = %00001000
000000r 1               ACIA_TX_INT_DISABLE_BREAK    = %00001100
000000r 1               ACIA_RX_INT_ENABLE           = %00000000
000000r 1               ACIA_RX_INT_DISABLE          = %00000010
000000r 1               ACIA_DTR_HIGH                = %00000000
000000r 1               ACIA_DTR_LOW                 = %00000001
000000r 1               
000000r 1                       .code
000000r 1               _acia_init:
000000r 1  A9 00                lda #$00
000002r 1  8D rr rr             sta ACIA_STATUS
000005r 1  A9 09                lda #(ACIA_PARITY_DISABLE | ACIA_ECHO_DISABLE | ACIA_TX_INT_DISABLE_RTS_LOW | ACIA_RX_INT_ENABLE | ACIA_DTR_LOW)
000007r 1  8D rr rr             sta ACIA_COMMAND
00000Ar 1                       ; lda #$1f        ; 19200
00000Ar 1  A9 10                lda #$10        ; 1/16th of clock (115200)
00000Cr 1  8D rr rr             sta ACIA_CONTROL
00000Fr 1  60                   rts
000010r 1               
000010r 1               _acia_read_byte_nw:
000010r 1  18                   clc
000011r 1  AD rr rr             lda    ACIA_STATUS
000014r 1  29 08                and    #$08
000016r 1  F0 04                beq    @done
000018r 1  AD rr rr             lda    ACIA_DATA
00001Br 1  38                   sec
00001Cr 1               @done:
00001Cr 1  60                   rts
00001Dr 1               
00001Dr 1               _acia_read_byte:
00001Dr 1               @wait_rxd_full:
00001Dr 1  AD rr rr             lda ACIA_STATUS
000020r 1  29 08                and #$08
000022r 1  F0 F9                beq @wait_rxd_full
000024r 1  AD rr rr             lda ACIA_DATA
000027r 1  60                   rts
000028r 1               
000028r 1               _acia_write_byte:
000028r 1  48                   pha                     ; save char
000029r 1               @wait_txd_empty:
000029r 1  AD rr rr             lda ACIA_STATUS
00002Cr 1  29 10                and #$10
00002Er 1  F0 F9                beq @wait_txd_empty
000030r 1  68                   pla                     ; restore char
000031r 1  8D rr rr             sta ACIA_DATA
000034r 1  60                   rts
000034r 1               
